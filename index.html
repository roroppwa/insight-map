<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>로로뽜 인사이트 대시보드</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --border:#e5e7eb;
  --muted:#6b7280;
  --muted2:#9ca3af;
  --accent:#ef4444;   /* 메인 포인트: 레드 */
}

/* 전체 배경/폰트 */
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:#f8fafc;
  color:#111827;
}

/* 헤더 영역 */
.header{
  border-bottom:1px solid var(--border);
  background:#ffffff;
}
.header-inner{
  max-width:1200px;
  margin:0 auto;
  padding:18px 16px 12px 16px;
  text-align:center;
}
.title{
  font-weight:800;
  font-size:24px;
  margin:0 0 4px 0;
  color:#7f1d1d;
}
.sub{
  font-size:13px;
  color:var(--muted);
  margin:0 0 2px 0;
}
.meta{
  font-size:12px;
  color:var(--muted2);
}

/* 본문 래퍼 */
.wrap{
  max-width:1200px;
  margin:0 auto;
  padding:20px 16px 40px 16px;
}

/* 카드(Box) */
.box{
  padding:14px 18px;
  background:#ffffff;
  border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:16px;
  box-shadow:0 8px 16px rgba(15,23,42,0.03);
}
.box h2{
  margin:0 0 6px 0;
  font-size:16px;
  color:#111827;
}
.box p{
  margin:0;
  font-size:14px;
}
ul{
  margin:0;
  padding-left:18px;
  font-size:14px;
}
ul li{
  margin-bottom:4px;
  line-height:1.45;
}

/* 버튼 */
.btn{
  display:inline-block;
  padding:8px 16px;
  margin-top:18px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#ffffff;
  color:#111827;
  font-size:13px;
  font-weight:600;
  cursor:pointer;
  text-decoration:none;
}
.btn:hover{
  background:#fee2e2;
}

/* 배지 */
.badge{
  display:inline-block;
  padding:2px 8px;
  font-size:11px;
  border-radius:999px;
  background:#fee2e2;
  color:#b91c1c;
  margin-left:4px;
}

/* 강조 컬러/텍스트 */
.theme-title{
  color:#111827;
  font-weight:800;
}
.up-text{
  color:#dc2626;
  font-weight:700;
}
.down-text{
  color:#1d4ed8;
  font-weight:700;
}
.key-number{
  font-weight:800;
  color:var(--accent);
}
.ratio-high{
  color:#dc2626;
  font-weight:600;
}
.ratio-low{
  color:#1d4ed8;
  font-weight:600;
}
.strong-label{
  color:#0f172a;
  font-weight:700;
}

/* 수급 주체별 컬러 배지 (텍스트용만) */
.badge-foreign{
  background:#e0f2fe;
  color:#0369a1;
}
.badge-inst{
  background:#dcfce7;
  color:#166534;
}
.badge-ind{
  background:#fef3c7;
  color:#b45309;
}

/* 시총/거래대금용 작은 태그 */
.tag-small{
  display:inline-block;
  padding:1px 6px;
  margin-left:4px;
  border-radius:999px;
  font-size:11px;
  background:#e5e7eb;
  color:#374151;
}

/* 퍼센트 히트맵용 기본 스타일 */
.pct-value{
  display:inline-block;
  padding:0 6px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
  background:#e5e7eb;
  color:#374151;
}

/* 보조 텍스트 */
.muted{
  color:var(--muted);
  font-size:13px;
}

/* 두 칼럼 그리드 */
.grid-2{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
}

.notice-rr {
  background: #fef2f2;
  padding: 10px 14px;
  font-size: 14px;
  color: #7f1d1d;
  border-radius: 8px;
  font-weight: 700;
}
</style>
</head>
<body>
<div class="header">
  <div class="header-inner">
    <h1 class="title">로로뽜 인사이트 대시보드</h1>
    <p class="sub">테마별 가격(상승/하락), 수급(외국인·기관·개인), 시총·거래대금 특성을 한 눈에 요약한 화면입니다.</p>
    <p class="meta">최근 업데이트: 2025-11-14 (Fri) 12:20 (KST)</p>
    <p class="notice-rr">※ 이 대시보드는 <strong>로로뽜가 스크립트를 실행할 때만</strong> 갱신되며, <strong>로로뽜 부재 시에는 업데이트가 중단됩니다.</strong></p>
  </div>
</div>

<div class="wrap">
  <div class="box">
    <h2>전체 테마 개수</h2>
    <p><span class="key-number">25</span>개</p>
  </div>

  <div class="box">
    <h2>지표 해석 가이드</h2>
    <ul>
      <li><strong>상승 비율</strong>: 테마 내 종목 중 등락률이 <code>+%</code>인 종목 수 ÷ 전체 종목 수 × 100</li>
      <li><strong>하락 비율</strong>: 테마 내 종목 중 등락률이 <code>-%</code>인 종목 수 ÷ 전체 종목 수 × 100</li>
      <li><strong>평균 등락률</strong>: 테마 내 모든 종목의 등락률(%)을 단순 평균한 값</li>
      <li><strong>외국인/기관/개인 매수 비율</strong>: 테마 내 종목 중 해당 주체의 수급 값이 <code>&gt; 0</code>(순매수)인 종목 수 ÷ 전체 종목 수 × 100</li>
      <li><strong>시가총액 합계</strong>: 테마에 속한 모든 종목의 시총을 억(億) 단위로 환산해 합산한 값</li>
      <li><strong>시가총액 중간값(Median)</strong>: 시총을 작은 순서대로 정렬했을 때 한가운데에 위치한 값(대형주 영향을 완화한 대표값)</li>
      <li><strong>시가총액 Top3 합계</strong>: 시총 상위 3개 종목의 시총만 합산한 값(핵심 대형주 중심 규모)</li>
      <li><strong>거래대금 지표</strong>: 거래대금은 TSV에서 <code>백만 원</code> 단위로 주어지며, 화면에는 원 단위로 환산 후 조/억/만/원 포맷으로 표시합니다. 합계/평균/Median/Top3 개념은 시총과 동일합니다.</li>
      <li><strong>수급 값의 단위</strong>: TSV의 14/15/16열 실제 단위(금액/수량 등)와 관계없이, 이 대시보드에서는 <strong>부호(＋/?)만 사용</strong>해 순매수/순매도를 구분합니다.</li>
    </ul>
    <p class="muted">※ 예) 외국인 매수 비율 40% = 테마에 속한 종목 20개 중 8개가 외국인 순매수라는 의미입니다.</p>
  </div>

  <!-- detail.html 상단 버튼 -->
  <div class="box" style="display:flex;justify-content:space-between;align-items:center;">
    <div>
      <p class="muted">
        <span class="strong-label">전체 테마 맵(detail.html)</span>에서
        개별 종목 구성과 상세 데이터를 더 자세히 확인할 수 있습니다.
      </p>
    </div>
    <div>
      <a class="btn" style="background:var(--accent);color:#ffffff;border-color:var(--accent);" href="detail.html">
        자세히 보기 (전체 테마 맵)
      </a>
    </div>
  </div>

  <div class="box">
    <h2>상승 테마 TOP3 <span class="badge">상승 비율 기준</span></h2>
    <ul>
      <li><span class="theme-title">금융</span>: <span class="up-text">상승</span> <span class="key-number">11/11개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>), 평균 등락률 <span class="key-number">3.649%</span></li>
      <li><span class="theme-title">증권</span>: <span class="up-text">상승</span> <span class="key-number">17/17개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>), 평균 등락률 <span class="key-number">4.390%</span></li>
      <li><span class="theme-title">풍력</span>: <span class="up-text">상승</span> <span class="key-number">7/7개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>), 평균 등락률 <span class="key-number">2.866%</span></li>
    </ul>
    <p class="muted">* 각 테마 내에서 등락률이 플러스(+%)인 종목 비율을 기준으로 정렬했습니다.</p>
  </div>

  <div class="box">
    <h2>하락 테마 TOP3 <span class="badge">하락 비율 기준</span></h2>
    <ul>
      <li><span class="theme-title">반도체소재부품</span>: <span class="down-text">하락</span> <span class="key-number">9/10개</span> (<span class="pct-value" data-pct="90.0">90.0%</span>), 평균 등락률 <span class="key-number">-2.446%</span></li>
      <li><span class="theme-title">반도체</span>: <span class="down-text">하락</span> <span class="key-number">11/17개</span> (<span class="pct-value" data-pct="64.7">64.7%</span>), 평균 등락률 <span class="key-number">-0.487%</span></li>
      <li><span class="theme-title">통신</span>: <span class="down-text">하락</span> <span class="key-number">4/7개</span> (<span class="pct-value" data-pct="57.1">57.1%</span>), 평균 등락률 <span class="key-number">-1.083%</span></li>
    </ul>
    <p class="muted">* 하락 비율이 높은 순으로 정렬했습니다.</p>
  </div>

  <div class="grid-2">
    <div class="box">
      <h2>상승 비율 TOP3 차트</h2>
      <canvas id="upRatioChart" height="200"></canvas>
      <p class="muted">그래프는 상승 비율(%) 기준 상위 3개 테마를 보여줍니다.</p>
    </div>

    <div class="box">
      <h2>하락 비율 TOP3 차트</h2>
      <canvas id="downRatioChart" height="200"></canvas>
      <p class="muted">그래프는 하락 비율(%) 기준 상위 3개 테마를 보여줍니다.</p>
    </div>
  </div>

  <div class="grid-2">
    <div class="box">
      <h2>외국인 매수 비율 상위 테마 TOP5 <span class="badge badge-foreign">외국인</span></h2>
      <ul>
        <li><span class="theme-title">2차전지</span>: 외국인 매수 종목 <span class="key-number">6/6개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>)</li>
        <li><span class="theme-title">풍력</span>: 외국인 매수 종목 <span class="key-number">7/7개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>)</li>
        <li><span class="theme-title">식음료</span>: 외국인 매수 종목 <span class="key-number">22/23개</span> (<span class="pct-value" data-pct="95.7">95.7%</span>)</li>
        <li><span class="theme-title">화장품</span>: 외국인 매수 종목 <span class="key-number">21/23개</span> (<span class="pct-value" data-pct="91.3">91.3%</span>)</li>
        <li><span class="theme-title">금융</span>: 외국인 매수 종목 <span class="key-number">10/11개</span> (<span class="pct-value" data-pct="90.9">90.9%</span>)</li>
      </ul>
      <p class="muted">
        * 이 비율은 테마 내 전체 종목 수를 분모로 하고, 외국인 수급 값이 0보다 큰(순매수) 종목 수를 분자로 계산한 값입니다.
        수급 값의 절대 크기는 사용하지 않고 부호(＋/?)만 사용합니다.
      </p>
    </div>

    <div class="box">
      <h2>기관 매수 비율 상위 테마 TOP5 <span class="badge badge-inst">기관</span></h2>
      <ul>
        <li><span class="theme-title">금융</span>: 기관 매수 종목 <span class="key-number">9/11개</span> (<span class="pct-value" data-pct="81.8">81.8%</span>)</li>
        <li><span class="theme-title">증권</span>: 기관 매수 종목 <span class="key-number">13/17개</span> (<span class="pct-value" data-pct="76.5">76.5%</span>)</li>
        <li><span class="theme-title">우주항공</span>: 기관 매수 종목 <span class="key-number">4/6개</span> (<span class="pct-value" data-pct="66.7">66.7%</span>)</li>
        <li><span class="theme-title">반도체장비</span>: 기관 매수 종목 <span class="key-number">7/11개</span> (<span class="pct-value" data-pct="63.6">63.6%</span>)</li>
        <li><span class="theme-title">로봇</span>: 기관 매수 종목 <span class="key-number">15/24개</span> (<span class="pct-value" data-pct="62.5">62.5%</span>)</li>
      </ul>
      <p class="muted">
        * 이 비율은 테마 내 전체 종목 수를 분모로 하고, 기관 수급 값이 0보다 큰(순매수) 종목 수를 분자로 계산한 값입니다.
      </p>
    </div>
  </div>

  <div class="box">
    <h2>개인 매수 비율 상위 테마 TOP5 <span class="badge badge-ind">개인</span></h2>
    <ul>
      <li><span class="theme-title">2차전지</span>: 개인 매수 종목 <span class="key-number">6/6개</span> (<span class="pct-value" data-pct="100.0">100.0%</span>)</li>
      <li><span class="theme-title">인공지능</span>: 개인 매수 종목 <span class="key-number">8/9개</span> (<span class="pct-value" data-pct="88.9">88.9%</span>)</li>
      <li><span class="theme-title">통신</span>: 개인 매수 종목 <span class="key-number">6/7개</span> (<span class="pct-value" data-pct="85.7">85.7%</span>)</li>
      <li><span class="theme-title">ESS</span>: 개인 매수 종목 <span class="key-number">11/13개</span> (<span class="pct-value" data-pct="84.6">84.6%</span>)</li>
      <li><span class="theme-title">로봇</span>: 개인 매수 종목 <span class="key-number">20/24개</span> (<span class="pct-value" data-pct="83.3">83.3%</span>)</li>
    </ul>
    <p class="muted">
      * 이 비율은 테마 내 전체 종목 수를 분모로 하고, 개인 수급 값이 0보다 큰(순매수) 종목 수를 분자로 계산한 값입니다.
    </p>
  </div>

  <div class="grid-2">
    <div class="box">
      <h2>시가총액 기준 테마 TOP5
        <span class="badge">Median 시총 기준</span>
        <span class="tag-small">Top3·합계는 참고용</span>
      </h2>
      <ul>
        <li><span class="theme-title">2차전지</span>: 시총 중간값 <span class="key-number">23.64조</span>, Top3 합계 <span class="key-number">164.93조</span> <span class="muted">(평균 36.77조, 전체 합계 220.61조)</span></li>
        <li><span class="theme-title">금융</span>: 시총 중간값 <span class="key-number">10.70조</span>, Top3 합계 <span class="key-number">117.72조</span> <span class="muted">(평균 16.12조, 전체 합계 177.30조)</span></li>
        <li><span class="theme-title">우주항공</span>: 시총 중간값 <span class="key-number">9.49조</span>, Top3 합계 <span class="key-number">69.77조</span> <span class="muted">(평균 13.28조, 전체 합계 79.71조)</span></li>
        <li><span class="theme-title">바이오</span>: 시총 중간값 <span class="key-number">2.79조</span>, Top3 합계 <span class="key-number">158.39조</span> <span class="muted">(평균 8.10조, 전체 합계 251.16조)</span></li>
        <li><span class="theme-title">지주사</span>: 시총 중간값 <span class="key-number">2.20조</span>, Top3 합계 <span class="key-number">107.34조</span> <span class="muted">(평균 8.42조, 전체 합계 210.55조)</span></li>
      </ul>
      <p class="muted">
        * 시총 랭킹은 테마 내 종목들의 시총 중간값(Median)을 기준으로 합니다.
        대형주 한두 개에 덜 민감하며, Top3/합계는 보조 지표로 참고용으로 제공합니다.
      </p>
    </div>

    <div class="box">
      <h2>거래대금 기준 테마 TOP5
        <span class="badge">Median 거래대금 기준</span>
        <span class="tag-small">Top3·합계는 참고용</span>
      </h2>
      <ul>
        <li><span class="theme-title">2차전지</span>: 거래대금 중간값 <span class="key-number">859.4억원</span>, Top3 합계 <span class="key-number">3922.8억원</span> <span class="muted">(평균 919.9억원, 전체 합계 5519.1억원)</span></li>
        <li><span class="theme-title">우주항공</span>: 거래대금 중간값 <span class="key-number">548.3억원</span>, Top3 합계 <span class="key-number">3020.4억원</span> <span class="muted">(평균 586.0억원, 전체 합계 3516.2억원)</span></li>
        <li><span class="theme-title">바이오</span>: 거래대금 중간값 <span class="key-number">407.6억원</span>, Top3 합계 <span class="key-number">1.2조원</span> <span class="muted">(평균 1013.9억원, 전체 합계 3.1조원)</span></li>
        <li><span class="theme-title">금융</span>: 거래대금 중간값 <span class="key-number">232.1억원</span>, Top3 합계 <span class="key-number">4211.5억원</span> <span class="muted">(평균 555.5억원, 전체 합계 6110.8억원)</span></li>
        <li><span class="theme-title">반도체</span>: 거래대금 중간값 <span class="key-number">208.0억원</span>, Top3 합계 <span class="key-number">3.9조원</span> <span class="muted">(평균 2493.7억원, 전체 합계 4.2조원)</span></li>
      </ul>
      <p class="muted">
        * 거래대금 랭킹 역시 종목당 Median(중간값)을 기준으로 하며,
          상위 3개 종목의 합계/전체 합계를 함께 보여줘 유동성 규모까지 함께 파악할 수 있습니다.
      </p>
    </div>
  </div>

</div>

<!-- Chart.js: 상승/하락 비율 TOP3 막대 그래프 -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
(function() {
  var upCtx = document.getElementById('upRatioChart');
  var downCtx = document.getElementById('downRatioChart');

  var upLabels = ["금융","증권","풍력"];
  var upData   = [100.0,100.0,100.0];

  var downLabels = ["반도체소재부품","반도체","통신"];
  var downData   = [90.0,64.7,57.1];

  if (upCtx) {
    new Chart(upCtx, {
      type: 'bar',
      data: {
        labels: upLabels,
        datasets: [{
          label: '상승 비율 (%)',
          data: upData,
          backgroundColor: '#ef4444'   // 빨강
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, max: 100 }
        }
      }
    });
  }

  if (downCtx) {
    new Chart(downCtx, {
      type: 'bar',
      data: {
        labels: downLabels,
        datasets: [{
          label: '하락 비율 (%)',
          data: downData,
          backgroundColor: '#1d4ed8'
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          y: { beginAtZero: true, max: 100 }
        }
      }
    });
  }
})();
</script>

<!-- 퍼센트 히트맵: .pct-value[data-pct] 에 색 입히기 -->
<script>
(function() {
  var nodes = document.querySelectorAll(".pct-value");
  nodes.forEach(function(el) {
    var v = parseFloat(el.getAttribute("data-pct"));
    if (isNaN(v)) return;

    var bg = "#e5e7eb";
    var color = "#374151";

    if (v >= 70) {         // 매우 높은 비율
      bg = "#fee2e2";
      color = "#b91c1c";
    } else if (v >= 50) {  // 꽤 높은 비율
      bg = "#ffedd5";
      color = "#c2410c";
    } else if (v >= 30) {  // 중간 이상
      bg = "#dcfce7";
      color = "#15803d";
    } else {               // 낮은 비율
      bg = "#e5e7eb";
      color = "#374151";
    }

    el.style.backgroundColor = bg;
    el.style.color = color;
  });
})();
</script>

</body>
</html>
